# ごみ出し予報 (Gomidashi Yoho)

Googleスプレッドシートをデータベースとして活用する、個人用途に特化したLINEリマインダーBotです。

## 概要

「今日のごみは何か」という日常の小さな疑問を解消するために開発された、パーソナルなごみ出し日管理Botです。LINEアカウントさえあれば、直感的なインターフェースを通じて、ごみの収集日を迅速に確認・登録・変更できます。

バックエンドはGoogle Apps Script（GAS）で構築されており、サーバーレスでの低コスト運用が可能です。家族や親しい友人など、クローズドなコミュニティでの利用を想定しています。

## 主な機能

* **高性能なダブルリマインダー**
    「前日の夜」と「当日の朝」の2つのタイミングで通知を設定可能。それぞれの時刻はカルーセルUIから独立して設定・停止でき、ごみ出しの準備と実行の両方をサポートします。

* **洗練されたインターフェース**
    「今日」「明日」の確認、予定変更後の確認、リマインダー通知など、Botからの主要な応答はすべて統一されたカード形式（Flex Message）で表示。情報を直感的に把握できます。

* **直感的なスケジュール編集**
    「一覧」と送信すると、1週間の予定がカルーセル形式で表示されます。予定を変更したい曜日をタップするだけで、対話形式の編集モードに移行するため、コマンドを覚える必要がありません。

* **確実な利用開始フロー**
    Botの利用開始には、まず利用規約への同意が必要です。新規ユーザーには明確な同意確認フローを提示し、同意した場合のみユーザー登録が完了します。

* **堅牢なシステム設計**
  * Webhook URLに秘密トークンを含めることで、第三者からの不正なリクエストを遮断します。
  * `LockService`を利用し、ボタンの連続タップによる処理の重複実行（競合状態）を防止します。

## 技術スタック

* **プラットフォーム**: LINE Messaging API
* **バックエンド**: Google Apps Script (GAS)
* **データベース**: Google Sheets
* **ローカル開発**: Visual Studio Code + clasp

## セットアップ

1. **LINE Developers Consoleでの設定**
    * プロバイダーとMessaging APIチャネルを作成します。
    * `チャネルアクセストークン`を取得します。

1. **Google Sheetsの準備**
    * 新規にGoogleスプレッドシートを作成し、`スプレッドシートID`を控えます。
    * シートを3つ作成し、それぞれ以下の通りにヘッダーを設定します。
        * **`Users`**: `userId`, `status`, `createdAt`, `updatedAt`, `reminderTimeNight`, `reminderTimeMorning`
        * **`Schedules`**: `userId`, `dayOfWeek`, `itemName`, `notes`
        * **`Allowlist`**: `userId`

1. **秘密トークンの準備**
    * Webhook URLの認証に使用する、推測されにくいランダムな文字列を生成します。

1. **Google Apps Script (GAS)プロジェクトの設定**
    * GASプロジェクトを新規作成し、リポジトリのコードを各ファイルにコピーします。
    * スクリプトプロパティに以下のキーと値を設定します。
        * `LINE_CHANNEL_ACCESS_TOKEN`: 手順1で取得したトークン
        * `SECRET_TOKEN`: 手順3で生成したトークン
        * `DATABASE_SHEET_ID`: 手順2で控えたスプレッドシートID
        * `LOG_ID`: （任意）ログ記録用の別スプレッドシートのID

1. **デプロイとWebhook設定**
    * GASプロジェクトを「ウェブアプリ」としてデプロイし、ウェブアプリURLを取得します。
    * LINE Developers ConsoleのWebhook設定に、`【ウェブアプリURL】?token=【秘密トークン】`という形式でURLを貼り付け、「Webhookの利用」をオンにします。

## 利用規約とライセンス

本サービスの利用規約およびプライバシーポリシーについては、以下のページをご確認ください。

* [利用規約・プライバシーポリシー](./policy.md)

また、本プロジェクトのソースコードは **MIT License** のもとで公開されています。
